<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Qu·∫£n l√Ω t√†i kho·∫£n ng∆∞·ªùi d√πng</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  </head>

  <body class="bg-gray-100 font-semibold text-gray-900">
    <div class="flex">
      <!-- Sidebar -->
      <div class="bg-gray-50 p-6 border-r border-gray-300 min-h-screen shadow-md">
        <div class="text-blue-600 font-semibold text-2xl mb-10 ml-4">
          .FMCarer
        </div>
        <nav class="flex flex-col space-y-4">
          <a
            href="home.html"
            class="hover:bg-gray-200 px-4 py-2 rounded-md transition-colors">üè† Trang ch·ªß</a>
          <a
            href="user.html"
            class="bg-blue-100 text-blue-600 px-4 py-2 rounded-md font-semibold shadow">üë• Ng∆∞·ªùi d√πng</a>
          <a
            href="revenue.html"
            class="hover:bg-gray-200 px-4 py-2 rounded-md">üìÑ Th·ªëng k√™</a>
          <a
            href="support.html"
            class="hover:bg-gray-200 px-4 py-2 rounded-md">‚öôÔ∏è H·ªó tr·ª£</a>
          <a
            href="moderation.html"
            class="hover:bg-gray-200 px-4 py-2 rounded-md">‚öôÔ∏è Ki·ªÉm duy·ªát</a>
          <button
            onclick="auth.signOut().then(() => location.href='login.html')"
            class="bg-red-500 px-4 py-2 rounded-md text-gray-50 mt-10 hover:bg-red-600 transition">
            ƒêƒÉng xu·∫•t
          </button>
        </nav>
      </div>

      <!-- Main content -->
      <div class="flex-grow">
        <!-- Topbar -->
        <div
          class="bg-gray-50 p-4 border-b border-gray-300 flex justify-between items-center shadow">
          <h5 class="text-gray-900 font-semibold">Ng∆∞·ªùi d√πng</h5>
          <div class="flex items-center space-x-4">
            <span>Tr·∫ßn ƒê√¨nh Qu√¢n ‚ñº</span>
            <img src="https://tse3.mm.bing.net/th?id=OIP.8UnJNikrKFQPh5QF7ME9mQHaHn&pid=Api&P=0&h=180" 
                 class="rounded-full border-2 border-gray-300 p-0.5" 
                 alt="Avatar" 
                 width="40" 
                 height="40" 
                 style="object-fit:cover;"/>
          </div>
        </div>

        <!-- Main Section -->
        <div class="p-6">
          <h6 class="text-gray-900 font-semibold">Danh s√°ch t√†i kho·∫£n</h6>
          <div class="bg-gray-50 p-4 rounded-md shadow-md mt-3">
            <div class="table-auto w-full overflow-x-auto">
              <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-200 text-gray-700 font-semibold">
                    <th class="py-2 px-4">Full Name</th>
                    <th class="py-2 px-4">Username</th>
                    <th class="py-2 px-4">Image</th>
                    <th class="py-2 px-4">Bio</th>
                    <th class="py-2 px-4">Email</th>
                    <th class="py-2 px-4">Xo√°</th>
                   </tr>
                </thead>
                <tbody id="userTableBody" class="bg-gray-50">
                    <!-- D·ªØ ki·ªán s·∫Ω ƒë∆∞·ª£c th√™m t·∫°i ƒë√¢y -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase SDK compat -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
      // üî• C·∫•u h√¨nh Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyBxyaFIM3Ut8syuwNFng0YyYlrFbqVY450",
        authDomain: "sof102.firebaseapp.com",
        databaseURL: "https://sof102-default-rtdb.firebaseio.com",
        projectId: "sof102",
        storageBucket: "sof102.appspot.com",
        messagingSenderId: "810054011446",
        appId: "1:810054011446:web:c852a9f4cf0ab6dd756697",
        measurementId: "G-77NKLSP61K",
      };

      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }

      firebase.auth().onAuthStateChanged((user) => {
        if (!user || user.email !== "trandinhquan66@gmail.com") {
          window.location.href = "login.html";
          return;
        }

        const dbRef = firebase.database().ref("Users");

        dbRef
          .once("value")
          .then((snapshot) => {
            const tbody = document.getElementById("userTableBody");

            tbody.innerHTML = "";

            snapshot.forEach((child) => {
              const data = child.val();
              const uid = child.key;

              tbody.innerHTML += `
                <tr class="border-t hover:bg-gray-100 transition">
                    <td class="py-2 px-4">${data.fullname || ''}</td>
                    <td class="py-2 px-4">${data.username || ''}</td>
                    <td class="py-2 px-4">
                        <img src="${data.imageurl ||
                          ''}" alt="User Image" width="50" class="rounded-full border border-gray-300 p-0.5">
                    </td>
                    <td class="py-2 px-4">${data.bio || ''}</td>
                    <td class="py-2 px-4">${data.email || ''}</td>
                    <td class="py-2 px-4">
                        <button 
                        	onclick="deleteUser('${uid}')" 
                        	class="text-red-500 font-semibold hover:underline">
                        	üóë Xo√°
                        </button>
                    </td>
                </tr>`;
            });
          })
          .catch((err) => {
            console.error("L·ªói khi l·∫•y d·ªØ ki·ªán t·ª´ Realtime Database.", err);
          });
      });

      // üóëÔ∏è H√†m xo√° ng∆∞·ªùi d√πng
      function deleteUser(uid) {
        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° t√†i kho·∫£n n√†y?`)) {
          firebase
            .database()
            .ref("Users/" + uid)
            .remove()
            .then(() => {
              alert("ƒê√£ xo√° t√†i kho·∫£n.");
              location.reload();
            })
            .catch((err) => {
              console.error("L·ªói khi xo√°.", err);
            });
        }
      }
    </script>
  </body>
</html>
